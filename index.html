<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ª±c h√†nh x∆∞·ªüng LABS - Version 1.7 (Full Standards & Calculators)</title>
    <style>
        :root { --primary: #2980b9; --dark: #2c3e50; --success: #27ae60; --warning: #f39c12; --danger: #e74c3c; --bg: #f1f4f9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; padding: 15px; background-color: var(--bg); max-width: 1000px; margin: auto; color: #333; }
        h1 { color: var(--dark); text-align: center; text-transform: uppercase; border-bottom: 4px solid var(--primary); padding-bottom: 10px; margin-bottom: 25px; font-size: 1.5em; }
        
        .category { background: #fff; margin-bottom: 15px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid #dee2e6; overflow: hidden; }
        .category-header { background: var(--primary); color: white; padding: 18px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .category-content { display: none; padding: 10px; background: #fff; }
        .category.active > .category-content { display: block; }
        .category.active > .category-header { background: var(--dark); }

        .check-item { background: #fff; margin-bottom: 10px; border: 1px solid #edf2f7; border-radius: 8px; }
        .item-header { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; color: #2d3748; background: #f8fafc; border-left: 5px solid transparent; }
        .item-content { display: none; padding: 15px; border-top: 1px solid #edf2f7; }
        .check-item.active > .item-content { display: block; }
        .check-item.active > .item-header { border-left-color: var(--success); background: #ebf8ff; }

        /* Calculator UI */
        .calc-box { background: #ebf4ff; border: 1px solid #bee3f8; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .calc-box h4 { margin: 0 0 10px 0; color: var(--primary); font-size: 0.9em; text-transform: uppercase; }
        .calc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .calc-input-group { display: flex; flex-direction: column; }
        .calc-input-group label { font-size: 0.8em; margin-bottom: 4px; color: #4a5568; }
        .calc-input { padding: 8px; border: 1px solid #cbd5e0; border-radius: 4px; font-weight: bold; }
        .calc-result { margin-top: 10px; padding: 8px; border-radius: 4px; font-weight: bold; text-align: center; font-size: 0.9em; display: none; }

        .standard-box { background: #fffaf0; border: 1px solid #feebc8; padding: 12px; border-radius: 6px; margin-bottom: 15px; font-size: 0.85em; color: #744210; }
        textarea { width: 100%; min-height: 150px; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; font-family: inherit; font-size: 14px; margin-bottom: 10px; }
        
        .btn-capture { background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; display: inline-flex; align-items: center; gap: 8px; }
        .photo-container { margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .photo-wrapper { background: #f1f5f9; padding: 5px; border-radius: 6px; text-align: center; border: 1px solid #e2e8f0; position: relative; }
        .photo-preview { width: 100%; height: 100px; object-fit: cover; border-radius: 4px; }
        .img-name { font-size: 0.6em; color: #64748b; word-break: break-all; }
        .btn-clear { background: var(--danger); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; margin-top: 20px; width: 100%; font-weight: bold; }

        .pass { background-color: #c6f6d5; color: #22543d; display: block; }
        .fail { background-color: #fed7d7; color: #822727; display: block; }
    </style>
</head>
<body>

    <h1>Th·ª±c h√†nh x∆∞·ªüng LABS v1.7</h1>

    <div class="category">
        <div class="category-header" onclick="toggleAccordion(this, 'category')">
            I. AN TO√ÄN CH√ÅY N·ªî & THO√ÅT N·∫†N
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M5 7l5 5 5-5z"/></svg>
        </div>
        <div class="category-content">
            
            <div class="check-item" data-id="pccc_exit_width">
                <div class="item-header" onclick="toggleAccordion(this, 'check-item')">
                    1.1 T√≠nh to√°n B·ªÅ r·ªông Tho√°t n·∫°n (C·ª≠a/L·ªëi ƒëi)
                </div>
                <div class="item-content">
                    <div class="calc-box">
                        <h4>C√¥ng c·ª• t√≠nh b·ªÅ r·ªông c·ª≠a (5mm/ng∆∞·ªùi)</h4>
                        <div class="calc-grid">
                            <div class="calc-input-group">
                                <label>S·ªë ng∆∞·ªùi t·ªëi ƒëa:</label>
                                <input type="number" class="calc-input" id="people_count" oninput="calcExitWidth()">
                            </div>
                            <div class="calc-input-group">
                                <label>B·ªÅ r·ªông ƒëo th·ª±c t·∫ø (mm):</label>
                                <input type="number" class="calc-input" id="actual_width" oninput="calcExitWidth()">
                            </div>
                        </div>
                        <div id="res_exit" class="calc-result"></div>
                    </div>
                    <div class="standard-box">Min 810mm cho c·ª≠a, 915mm cho h√†nh lang. Kho·∫£ng c√°ch di chuy·ªÉn max 61m (ko sprinkler) / 76m (c√≥ sprinkler).</div>
                    <textarea class="data-input" oninput="saveData()" placeholder="Ghi nh·∫≠n hi·ªán tr·∫°ng l·ªëi tho√°t n·∫°n..."></textarea>
                    <input type="file" accept="image/*" capture="environment" multiple onchange="handleFiles(this, 'PCCC_Exit')" style="display:none">
                    <button class="btn-capture" onclick="this.previousElementSibling.click()">üì∑ Ch·ª•p/Ch·ªçn h√¨nh</button>
                    <div class="photo-container"></div>
                </div>
            </div>

            <div class="check-item" data-id="pccc_fire_walls">
                <div class="item-header" onclick="toggleAccordion(this, 'check-item')">
                    1.2 NgƒÉn ch√°y & Khu v·ª±c nguy hi·ªÉm
                </div>
                <div class="item-content">
                    <div class="standard-box">T∆∞·ªùng ngƒÉn ch√°y 1h-2h. Kho h√≥a ch·∫•t ph·∫£i ngƒÉn ch√°y 1h v√† c√≥ khay ch·ªëng tr√†n (cao min 100mm). Tr·ª•c th√¥ng t·∫ßng ph·∫£i ƒë∆∞·ª£c b·∫£o v·ªá.</div>
                    <textarea class="data-input" oninput="saveData()" placeholder="Ki·ªÉm tra t∆∞·ªùng ngƒÉn, khay h√≥a ch·∫•t, c·ª≠a ngƒÉn ch√°y t·ª± ƒë√≥ng..."></textarea>
                    <input type="file" accept="image/*" capture="environment" multiple onchange="handleFiles(this, 'PCCC_Firewall')" style="display:none">
                    <button class="btn-capture" onclick="this.previousElementSibling.click()">üì∑ Ch·ª•p/Ch·ªçn h√¨nh</button>
                    <div class="photo-container"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="category">
        <div class="category-header" onclick="toggleAccordion(this, 'category')">
            II. AN TO√ÄN ƒêI·ªÜN (ELECTRICAL)
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M5 7l5 5 5-5z"/></svg>
        </div>
        <div class="category-content">
            <div class="check-item" data-id="elec_thermal">
                <div class="item-header" onclick="toggleAccordion(this, 'check-item')">
                    2.1 Ki·ªÉm tra Nhi·ªát ƒë·ªô (IR Thermography)
                </div>
                <div class="item-content">
                    <div class="calc-box">
                        <h4>C√¥ng c·ª• so s√°nh nhi·ªát ƒë·ªô LABS</h4>
                        <div class="calc-grid">
                            <div class="calc-input-group">
                                <label>T. M√¥i tr∆∞·ªùng (¬∞C):</label>
                                <input type="number" class="calc-input" id="temp_env" oninput="calcThermal()">
                            </div>
                            <div class="calc-input-group">
                                <label>T. ƒêi·ªÉm ƒëo (¬∞C):</label>
                                <input type="number" class="calc-input" id="temp_point" oninput="calcThermal()">
                            </div>
                        </div>
                        <div id="res_thermal" class="calc-result"></div>
                    </div>
                    <div class="standard-box">Delta T >20¬∞C: Theo d√µi; Delta T >30¬∞C ho·∫∑c T >70¬∞C: <b>H√†nh ƒë·ªông ngay l·∫≠p t·ª©c</b>.</div>
                    <textarea class="data-input" oninput="saveData()" placeholder="Ghi nh·∫≠n c√°c ƒëi·ªÉm qu√° nhi·ªát..."></textarea>
                    <input type="file" accept="image/*" capture="environment" multiple onchange="handleFiles(this, 'Elec_IR')" style="display:none">
                    <button class="btn-capture" onclick="this.previousElementSibling.click()">üì∑ Ch·ª•p/Ch·ªçn h√¨nh</button>
                    <div class="photo-container"></div>
                </div>
            </div>

            <div class="check-item" data-id="elec_panels">
                <div class="item-header" onclick="toggleAccordion(this, 'check-item')">
                    2.2 T·ªß ƒëi·ªán & Tr·∫°m ƒëi·ªán
                </div>
                <div class="item-content">
                    <div class="standard-box">Kho·∫£ng tr·ªëng thao t√°c 1m. S·∫°ch b·ª•i v·∫£i. Kh√¥ng v·∫≠t li·ªáu d·ªÖ ch√°y b√™n trong. C√≥ bi·ªÉn c·∫£nh b√°o. M√°y ph√°t ·ªëng x·∫£ cao h∆°n m√°i.</div>
                    <textarea class="data-input" oninput="saveData()" placeholder="Ki·ªÉm tra v·ªá sinh t·ªß ƒëi·ªán, ƒë√™ ngƒÉn d·∫ßu tr√†n m√°y ph√°t..."></textarea>
                    <input type="file" accept="image/*" capture="environment" multiple onchange="handleFiles(this, 'Elec_Panel')" style="display:none">
                    <button class="btn-capture" onclick="this.previousElementSibling.click()">üì∑ Ch·ª•p/Ch·ªçn h√¨nh</button>
                    <div class="photo-container"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="category">
        <div class="category-header" onclick="toggleAccordion(this, 'category')">
            III. AN TO√ÄN K·∫æT C·∫§U (STRUCTURAL)
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M5 7l5 5 5-5z"/></svg>
        </div>
        <div class="category-content">
            <div class="check-item" data-id="struct_calc">
                <div class="item-header" onclick="toggleAccordion(this, 'check-item')">
                    3.1 T·∫£i tr·ªçng & V·∫øt n·ª©t
                </div>
                <div class="item-content">
                    <div class="standard-box">B√°o ƒë·ªông ƒë·ªè khi c√≥ v·∫øt n·ª©t d·∫ßm/c·ªôt g√¢y nguy hi·ªÉm s·ª•p ƒë·ªï. T·∫£i tr·ªçng ch·∫•t h√†ng kh√¥ng v∆∞·ª£t thi·∫øt k·∫ø. B·∫≠c thang max 215mm.</div>
                    <textarea class="data-input" oninput="saveData()" placeholder="M√¥ t·∫£ v·∫øt n·ª©t, t·∫£i tr·ªçng s√†n th·ª±c t·∫ø..."></textarea>
                    <input type="file" accept="image/*" capture="environment" multiple onchange="handleFiles(this, 'Struct_Check')" style="display:none">
                    <button class="btn-capture" onclick="this.previousElementSibling.click()">üì∑ Ch·ª•p/Ch·ªçn h√¨nh</button>
                    <div class="photo-container"></div>
                </div>
            </div>
        </div>
    </div>

    <button class="btn-clear" onclick="clearAllData()">X√ìA TO√ÄN B·ªò D·ªÆ LI·ªÜU B√ÅO C√ÅO</button>

    <script>
        const STORAGE_KEY = 'LABS_REPORT_V17';

        function toggleAccordion(element, type) {
            const parent = element.parentElement;
            const isAlreadyActive = parent.classList.contains('active');
            const siblings = parent.parentElement.querySelectorAll(':scope > .' + type);
            siblings.forEach(s => s.classList.remove('active'));
            if (!isAlreadyActive) parent.classList.add('active');
        }

        // --- C√îNG C·ª§ T√çNH TO√ÅN NHANH ---
        function calcExitWidth() {
            const p = document.getElementById('people_count').value;
            const w = document.getElementById('actual_width').value;
            const res = document.getElementById('res_exit');
            if(!p || !w) return;
            const required = Math.max(810, p * 5);
            res.style.display = 'block';
            if(w >= required) {
                res.className = 'calc-result pass';
                res.innerText = `ƒê·∫†T. Y√™u c·∫ßu: ${required}mm (ƒêo ƒë∆∞·ª£c: ${w}mm)`;
            } else {
                res.className = 'calc-result fail';
                res.innerText = `KH√îNG ƒê·∫†T. Y√™u c·∫ßu: ${required}mm (Thi·∫øu ${required - w}mm)`;
            }
        }

        function calcThermal() {
            const env = parseFloat(document.getElementById('temp_env').value);
            const pnt = parseFloat(document.getElementById('temp_point').value);
            const res = document.getElementById('res_thermal');
            if(isNaN(env) || isNaN(pnt)) return;
            const delta = pnt - env;
            res.style.display = 'block';
            if(pnt > 70 || delta > 30) {
                res.className = 'calc-result fail';
                res.innerText = `NGUY HI·ªÇM (Delta T: ${delta}¬∞C). H√ÄNH ƒê·ªòNG NGAY!`;
            } else if(delta > 20) {
                res.className = 'calc-result fail';
                res.style.backgroundColor = '#feebc8'; // Warning color
                res.innerText = `C·∫¢NH B√ÅO (Delta T: ${delta}¬∞C). C·∫ßn theo d√µi.`;
            } else {
                res.className = 'calc-result pass';
                res.innerText = `AN TO√ÄN (Delta T: ${delta}¬∞C)`;
            }
        }

        // --- X·ª¨ L√ù D·ªÆ LI·ªÜU & H√åNH ·∫¢NH ---
        function handleFiles(input, itemName) {
            const container = input.parentElement.querySelector('.photo-container');
            const files = Array.from(input.files);
            const now = new Date();
            const dateStr = String(now.getDate()).padStart(2, '0') + String(now.getMonth() + 1).padStart(2, '0') + now.getFullYear();

            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    addPhotoToUI(container, e.target.result, `${dateStr}_${itemName}_${index+1}.jpg`);
                    saveData();
                }
                reader.readAsDataURL(file);
            });
        }

        function addPhotoToUI(container, src, fileName) {
            const wrap = document.createElement('div');
            wrap.className = 'photo-wrapper';
            wrap.innerHTML = `<img src="${src}" class="photo-preview"><div class="img-name">${fileName}</div>`;
            container.appendChild(wrap);
        }

        function saveData() {
            const data = {};
            document.querySelectorAll('.check-item').forEach(item => {
                const id = item.getAttribute('data-id');
                const text = item.querySelector('textarea').value;
                const photos = Array.from(item.querySelectorAll('.photo-preview')).map(img => ({
                    src: img.src, name: img.nextElementSibling.innerText
                }));
                data[id] = { text, photos };
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) return;
            const data = JSON.parse(saved);
            Object.keys(data).forEach(id => {
                const item = document.querySelector(`[data-id="${id}"]`);
                if(item) {
                    item.querySelector('textarea').value = data[id].text;
                    const container = item.querySelector('.photo-container');
                    data[id].photos.forEach(p => addPhotoToUI(container, p.src, p.name));
                }
            });
        }

        function clearAllData() {
            if(confirm('X√≥a s·∫°ch d·ªØ li·ªáu v√† h√¨nh ·∫£nh?')) { localStorage.removeItem(STORAGE_KEY); location.reload(); }
        }

        window.onload = loadData;
    </script>
</body>
</html>
